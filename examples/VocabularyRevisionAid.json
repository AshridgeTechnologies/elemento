{
  "id": "project_1",
  "name": "Vocabulary Revision",
  "kind": "Project",
  "properties": {},
  "elements": [
    {
      "id": "app1",
      "name": "Vocabulary Revision App",
      "kind": "App",
      "properties": {
        "author": "PB"
      },
      "elements": [
        {
          "id": "appbar_1",
          "name": "App Bar",
          "kind": "AppBar",
          "properties": {},
          "elements": [
            {
              "id": "text_13",
              "name": "App Title",
              "kind": "Text",
              "properties": {
                "content": "Vocabulary Revision",
                "fontSize": 20
              }
            },
            {
              "id": "button_18",
              "name": "Learn Button",
              "kind": "Button",
              "properties": {
                "content": "Learn",
                "filled": true,
                "action": {
                  "expr": "ShowPage(LearnPage)"
                }
              }
            },
            {
              "id": "button_14",
              "name": "Revision Button",
              "kind": "Button",
              "properties": {
                "content": "Revision",
                "filled": true,
                "action": {
                  "expr": "ShowPage(RevisionPage)"
                }
              }
            },
            {
              "id": "button_15",
              "name": "Words Button",
              "kind": "Button",
              "properties": {
                "content": "Words",
                "filled": true,
                "action": {
                  "expr": "ShowPage(WordDetailsPage)"
                }
              }
            },
            {
              "id": "button_20",
              "name": "Import Button",
              "kind": "Button",
              "properties": {
                "content": "Import",
                "filled": true,
                "action": {
                  "expr": "ShowPage(ImportPage)"
                }
              }
            }
          ]
        },
        {
          "id": "page_1",
          "name": "Word Details Page",
          "kind": "Page",
          "properties": {},
          "elements": [
            {
              "id": "layout_1",
              "name": "Page Layout ",
              "kind": "Layout",
              "properties": {
                "horizontal": true
              },
              "elements": [
                {
                  "id": "list_3",
                  "name": "WordList",
                  "kind": "List",
                  "properties": {
                    "items": {
                      "expr": "Sort(Words.Query({}), $item.Word)"
                    }
                  },
                  "elements": [
                    {
                      "id": "text_8",
                      "name": "ListWord",
                      "kind": "Text",
                      "properties": {
                        "content": {
                          "expr": "$item.Word"
                        }
                      }
                    }
                  ]
                },
                {
                  "id": "layout_2",
                  "name": "Widget Form",
                  "kind": "Layout",
                  "properties": {
                    "horizontal": false
                  },
                  "elements": [
                    {
                      "id": "data_1",
                      "name": "WordId",
                      "kind": "Data",
                      "properties": {
                        "display": false,
                        "initialValue": {
                          "expr": "WordList.selectedItem && WordList.selectedItem.id"
                        }
                      }
                    },
                    {
                      "id": "data_3",
                      "name": "TheWord",
                      "kind": "Data",
                      "properties": {
                        "initialValue": {
                          "expr": "WordId.value && Get(Words, WordId.value)"
                        },
                        "display": false
                      }
                    },
                    {
                      "id": "layout_4",
                      "name": "Layout 4",
                      "kind": "Layout",
                      "properties": {
                        "horizontal": true
                      },
                      "elements": [
                        {
                          "id": "text_3",
                          "name": "Page name",
                          "kind": "Text",
                          "properties": {
                            "content": "Word details",
                            "fontSize": 21
                          }
                        },
                        {
                          "id": "button_12",
                          "name": "New Word Button",
                          "kind": "Button",
                          "properties": {
                            "content": "New Word",
                            "action": {
                              "expr": "Reset(Word, Translation, WordList)"
                            }
                          }
                        }
                      ]
                    },
                    {
                      "id": "textinput_1",
                      "name": "Word",
                      "kind": "TextInput",
                      "properties": {
                        "width": "100%",
                        "initialValue": {
                          "expr": "TheWord.Word"
                        }
                      }
                    },
                    {
                      "id": "textinput_2",
                      "name": "Translation",
                      "kind": "TextInput",
                      "properties": {
                        "multiline": true,
                        "width": "100%",
                        "initialValue": {
                          "expr": "TheWord.Translation"
                        }
                      }
                    },
                    {
                      "id": "textinput_3",
                      "name": "Date Learned",
                      "kind": "TextInput",
                      "properties": {
                        "initialValue": {
                          "expr": "TheWord.DateLearned && DateFormat(TheWord.DateLearned, \"dd MMM yyyy\")"
                        },
                        "readOnly": true
                      }
                    },
                    {
                      "id": "textinput_4",
                      "name": "Last Revised",
                      "kind": "TextInput",
                      "properties": {
                        "initialValue": {
                          "expr": "TheWord.LastRevised && DateFormat(TheWord.LastRevised, \"dd MMM yyyy\")"
                        },
                        "readOnly": true
                      }
                    },
                    {
                      "id": "textinput_5",
                      "name": "Last Revised Ok",
                      "kind": "TextInput",
                      "properties": {
                        "initialValue": {
                          "expr": "TheWord.LastRevisedOk"
                        },
                        "readOnly": true
                      }
                    },
                    {
                      "id": "layout_3",
                      "name": "Page Buttons",
                      "kind": "Layout",
                      "properties": {
                        "horizontal": true,
                        "wrap": true,
                        "width": "100%"
                      },
                      "elements": [
                        {
                          "id": "button_8",
                          "name": "Add Word Button",
                          "kind": "Button",
                          "properties": {
                            "content": "Add Word",
                            "display": {
                              "expr": "!WordId.value"
                            },
                            "action": {
                              "expr": "let newWord = Record('id', 'w' + Timestamp(), 'Word', Word, 'Translation', Translation);\nAdd(Words, newWord);\nReset(Word, Translation);\nSet(WordList, newWord)"
                            }
                          }
                        },
                        {
                          "id": "button_9",
                          "name": "Update Widget Button",
                          "kind": "Button",
                          "properties": {
                            "content": "Save Changes",
                            "display": {
                              "expr": "!!WordId.value"
                            },
                            "action": {
                              "expr": "Update(Words, WordId, Record('Word', Word, 'Translation', Translation))\nReset(Word, Translation)"
                            }
                          }
                        },
                        {
                          "id": "button_10",
                          "name": "Cancel Button",
                          "kind": "Button",
                          "properties": {
                            "content": "Abandon Changes",
                            "action": {
                              "expr": "Reset(Word, Translation)"
                            }
                          }
                        },
                        {
                          "id": "button_11",
                          "name": "Delete Button",
                          "kind": "Button",
                          "properties": {
                            "content": "Delete",
                            "action": {
                              "expr": "Remove(Words, WordId)\nReset(WordList)\nReset(Word, Translation)"
                            },
                            "display": {
                              "expr": "!!WordId.value"
                            }
                          }
                        }
                      ]
                    },
                    {
                      "id": "text_4",
                      "name": "IdDisplay",
                      "kind": "Text",
                      "properties": {
                        "content": {
                          "expr": "WordId"
                        },
                        "display": false,
                        "color": "gray",
                        "width": 160,
                        "fontSize": 12
                      }
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "id": "page_2",
          "name": "Revision Page",
          "kind": "Page",
          "properties": {},
          "elements": [
            {
              "id": "data_6",
              "name": "Revision Periods",
              "kind": "Data",
              "properties": {
                "initialValue": {
                  "expr": "List(1, 7, 30, 180)"
                }
              }
            },
            {
              "id": "text_5",
              "name": "Title",
              "kind": "Text",
              "properties": {
                "content": "Revision",
                "fontSize": 20
              }
            },
            {
              "id": "function_1",
              "name": "UpToDate",
              "kind": "Function",
              "properties": {
                "input1": "word",
                "calculation": {
                  "expr": "let sinceLearned = If(word.DateLearned, DaysBetween(word.DateLearned, Today()), 0)\nlet latestRevisionTime = Last(RevisionPeriods, $item <= sinceLearned)\nlet latestRevisionDate = DateAdd(word.DateLearned, latestRevisionTime, 'days')\nlet revisedToday = DaysBetween(word.LastRevised, Today()) == 0\nlet latestRevisionDone = word.LastRevised && DaysBetween(latestRevisionDate, word.LastRevised) >= 0\nOr(Not(word.DateLearned), Not(latestRevisionTime), revisedToday, And(latestRevisionDone, word.LastRevisedOk))"
                }
              }
            },
            {
              "id": "data_4",
              "name": "WordsToRevise",
              "kind": "Data",
              "properties": {
                "initialValue": {
                  "expr": "Select(Words.Query({}), Not(UpToDate($item)))"
                }
              }
            },
            {
              "id": "list_2",
              "name": "WordList",
              "kind": "List",
              "properties": {
                "items": {
                  "expr": "Sort(WordsToRevise, $item.LastRevised)"
                },
                "width": "100%"
              },
              "elements": [
                {
                  "id": "layout_5",
                  "name": "Item Layout",
                  "kind": "Layout",
                  "properties": {
                    "horizontal": true,
                    "width": "100%"
                  },
                  "elements": [
                    {
                      "id": "text_6",
                      "name": "Word",
                      "kind": "Text",
                      "properties": {
                        "content": {
                          "expr": "$item.Word"
                        },
                        "width": "40%"
                      }
                    },
                    {
                      "id": "text_7",
                      "name": "Translation",
                      "kind": "Text",
                      "properties": {
                        "content": {
                          "expr": "$item.Translation"
                        },
                        "width": "40%",
                        "color": {
                          "expr": "If(ShowTranslation, 'inherit', 'transparent')"
                        }
                      }
                    },
                    {
                      "id": "data_9",
                      "name": "Show Translation",
                      "kind": "Data",
                      "properties": {
                        "initialValue": "false"
                      },
                      "elements": []
                    },
                    {
                      "id": "icon_7",
                      "name": "Visible Icon",
                      "kind": "Icon",
                      "properties": {
                        "iconName": {
                          "expr": "If(ShowTranslation, 'visibility', 'disabled_visible')"
                        },
                        "fontSize": 24,
                        "color": {
                          "expr": "If(ShowTranslation, 'blue', 'gray')"
                        },
                        "action": {
                          "expr": "Set(ShowTranslation, Not(ShowTranslation))"
                        },
                        "label": {
                          "expr": "If(ShowTranslation, 'Click to hide', 'Click to show')"
                        }
                      },
                      "elements": []
                    },
                    {
                      "id": "icon_5",
                      "name": "Revised Ok Icon",
                      "kind": "Icon",
                      "properties": {
                        "iconName": "check",
                        "display": true,
                        "color": "green",
                        "fontSize": 24,
                        "action": {
                          "expr": "Words.Update($item.id, Record('LastRevised', Today(), 'LastRevisedOk', true))"
                        }
                      },
                      "elements": []
                    },
                    {
                      "id": "icon_6",
                      "name": "Not Revised Ok Icon",
                      "kind": "Icon",
                      "properties": {
                        "iconName": "close",
                        "display": true,
                        "color": "red",
                        "fontSize": 24,
                        "action": {
                          "expr": "Words.Update($item.id, Record('LastRevised', Today(), 'LastRevisedOk', false))"
                        }
                      },
                      "elements": []
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "id": "page_3",
          "name": "Learn Page",
          "kind": "Page",
          "properties": {},
          "elements": [
            {
              "id": "text_9",
              "name": "Title",
              "kind": "Text",
              "properties": {
                "content": "Words to Learn",
                "fontSize": 20
              }
            },
            {
              "id": "data_5",
              "name": "WordsToLearn",
              "kind": "Data",
              "properties": {
                "initialValue": {
                  "expr": "Select(Words.Query({}), Or(Not($item.DateLearned), DaysBetween($item.DateLearned, Today()) == 0))"
                },
                "display": false
              }
            },
            {
              "id": "list_4",
              "name": "WordList",
              "kind": "List",
              "properties": {
                "items": {
                  "expr": "WordsToLearn"
                },
                "width": "100%"
              },
              "elements": [
                {
                  "id": "layout_6",
                  "name": "Item Layout",
                  "kind": "Layout",
                  "properties": {
                    "horizontal": true,
                    "width": "100%"
                  },
                  "elements": [
                    {
                      "id": "text_10",
                      "name": "Word",
                      "kind": "Text",
                      "properties": {
                        "content": {
                          "expr": "$item.Word"
                        },
                        "width": "40%"
                      }
                    },
                    {
                      "id": "text_11",
                      "name": "Translation",
                      "kind": "Text",
                      "properties": {
                        "content": {
                          "expr": "$item.Translation"
                        },
                        "width": "40%",
                        "color": {
                          "expr": "If(ShowTranslation, 'inherit', 'transparent')"
                        }
                      }
                    },
                    {
                      "id": "icon_2",
                      "name": "Visible Icon",
                      "kind": "Icon",
                      "properties": {
                        "iconName": {
                          "expr": "If(ShowTranslation, 'visibility', 'disabled_visible')"
                        },
                        "fontSize": 24,
                        "color": {
                          "expr": "If(ShowTranslation, 'blue', 'gray')"
                        },
                        "action": {
                          "expr": "Set(ShowTranslation, Not(ShowTranslation))"
                        },
                        "label": {
                          "expr": "If(ShowTranslation, 'Click to hide', 'Click to show')"
                        }
                      },
                      "elements": []
                    },
                    {
                      "id": "data_8",
                      "name": "Learned",
                      "kind": "Data",
                      "properties": {
                        "initialValue": {
                          "expr": "!!$item.DateLearned"
                        }
                      },
                      "elements": []
                    },
                    {
                      "id": "icon_3",
                      "name": "Not Learned Icon",
                      "kind": "Icon",
                      "properties": {
                        "iconName": "close",
                        "display": {
                          "expr": "Not(Learned)"
                        },
                        "color": "red",
                        "fontSize": 24,
                        "action": {
                          "expr": "Words.Update($item.id, Record('DateLearned', Today()))"
                        }
                      },
                      "elements": []
                    },
                    {
                      "id": "icon_4",
                      "name": "Learned Icon",
                      "kind": "Icon",
                      "properties": {
                        "iconName": "check",
                        "display": {
                          "expr": "Learned"
                        },
                        "color": "green",
                        "fontSize": 24,
                        "action": {
                          "expr": "Words.Update($item.id, Record('DateLearned', null))"
                        }
                      },
                      "elements": []
                    },
                    {
                      "id": "data_7",
                      "name": "Show Translation",
                      "kind": "Data",
                      "properties": {
                        "initialValue": "true"
                      },
                      "elements": []
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "id": "page_4",
          "name": "Import Page",
          "kind": "Page",
          "properties": {},
          "elements": [
            {
              "id": "text_12",
              "name": "Title",
              "kind": "Text",
              "properties": {
                "content": "Import  words",
                "fontSize": 20
              }
            },
            {
              "id": "text_14",
              "name": "Text 14",
              "kind": "Text",
              "properties": {
                "content": "Data columns are:\nWord, Translation, Date Learned, Last Revised, Last Revised Ok",
                "fontSize": 14
              },
              "elements": []
            },
            {
              "id": "textinput_6",
              "name": "Csv Text",
              "kind": "TextInput",
              "properties": {
                "multiline": true,
                "width": "100%",
                "label": "Type or paste comma-separated value rows here"
              }
            },
            {
              "id": "button_21",
              "name": "Import Button",
              "kind": "Button",
              "properties": {
                "content": "Import",
                "action": {
                  "expr": "let columns = List('Word', 'Translation', 'Date Learned', 'Last Revised', 'Last Revised Ok')\nlet newItems =  CsvToRecords(CsvText.value, columns)\nLog(newItems)\nAdd(Words, newItems)"
                }
              }
            }
          ]
        },
        {
          "id": "browserdatastore_1",
          "name": "Browser Data Store 1",
          "kind": "BrowserDataStore",
          "properties": {
            "databaseName": "VocabularyRevision",
            "collectionNames": [
              "Words"
            ]
          },
          "elements": []
        },
        {
          "id": "collection_1",
          "name": "Words",
          "kind": "Collection",
          "properties": {
            "collectionName": "Words",
            "dataStore": {
              "expr": "BrowserDataStore1"
            },
            "display": false
          }
        }
      ]
    }
  ]
}